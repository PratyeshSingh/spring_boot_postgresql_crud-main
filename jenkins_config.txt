pipeline{
    agent any

    tools {
        // Install the Maven version configured as "M3" and add it to the path.
        maven "M3"
    }

    environment {
        PATH = "/usr/local/bin:/Applications/Docker.app/Contents/Resources/bin:${env.PATH}"
    }

    stages {

        stage('Check Tools') {
            steps {
                sh 'mvn -version'
                sh 'docker --version'
            }
        }

        stage('Maven Build') {
            steps {
                // Checkout source code from GitHub
                checkout scmGit(
                    branches: [[name: '*/master']],
                    extensions: [],
                    userRemoteConfigs: [[
                        url: 'https://github.com/PratyeshSingh/spring_boot_postgresql_crud-main.git'
                    ]]
                )

                // Run Maven build
                sh 'mvn clean install'
            }
        }

        stage('Build Docker Image') {
            steps {
                script{
                    sh 'docker build -t pratyesh3/spring-boot-crud-docker .'
                }
            }
        }

        stage('Run Docker Image') {
            steps {
                script{
                    sh 'docker run -d -p 7090:7090 pratyesh3/spring-boot-crud-docker'
                }
            }
        }
     }
 }